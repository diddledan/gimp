name: gimp
version: '2.10.4'
summary: GNU Image Manipulation Program
description: |
  Whether you are a graphic designer, photographer, illustrator, or scientist,
  GIMP provides you with sophisticated tools to get your job done. You can
  further enhance your productivity with GIMP thanks to many customization
  options and 3rd party plugins.
icon: gimp.png

grade: stable
confinement: strict

apps:
  gimp:
    command: desktop-launch alsa-launch $SNAP/usr/bin/gimp
    desktop: usr/share/applications/gimp.desktop
    environment:
      BABL_PATH: $SNAP/usr/lib/babl-0.1
      GEGL_PATH: $SNAP/usr/lib/gegl-0.4
      GIMP2_DATADIR: $SNAP/usr/share/gimp/2.0
      GIMP2_LOCALEDIR: $SNAP/usr/share/locale
      GIMP2_PLUGINDIR: $SNAP/usr/lib/gimp/2.0
      GIMP2_SYSCONFDIR: $SNAP/etc/gimp/2.0
      LD_LIBRARY_PATH: $SNAP/usr/lib/libblas:$SNAP/usr/lib/lapack:$LD_LIBRARY_PATH
      PYTHONPATH: $SNAP/usr/lib/python2.7:$SNAP/usr/lib/python2.7/site-packages:$PYTHONPATH
    plugs:
    - cups-control
    - desktop
    - desktop-legacy
    - gsettings
    - home
    - opengl
    - removable-media
    - unity7
    - wayland
    - x11

parts:
  fix-pkgconfig-files:
    plugin: nil
    override-build: |
      cat <<EOF > $SNAPCRAFT_PART_INSTALL/fix-pkgconfig-files.sh
      for pcfile in \$SNAPCRAFT_PART_INSTALL/usr/lib/\$SNAPCRAFT_ARCH_TRIPLET/pkgconfig/*.pc \$SNAPCRAFT_PART_INSTALL/usr/lib/pkgconfig/*.pc \$SNAPCRAFT_PART_INSTALL/usr/local/lib/\$SNAPCRAFT_ARCH_TRIPLET/pkgconfig/*.pc \$SNAPCRAFT_PART_INSTALL/usr/local/lib/pkgconfig/*.pc; do
        sed -i -E "s~^((include|lib)dir=)/usr(/local)?~\1\\\${prefix}~g" \$pcfile || true
        sed -i -E "s~^((exec_)?prefix=)(/usr(/local)?)~\1/\3~" \$pcfile || true
      done
      EOF
      chmod +x $SNAPCRAFT_PART_INSTALL/fix-pkgconfig-files.sh
    prime:
    - -*

  fix-symlinks:
    # REF: https://unix.stackexchange.com/questions/100918/convert-absolute-symlink-to-relative-symlink-with-simple-linux-command
    plugin: nil
    override-build: |
      cat <<EOF > $SNAPCRAFT_PART_INSTALL/fix-symlinks.sh
      cd \$SNAPCRAFT_PART_INSTALL
      find . -lname '/*' |
      while read l ; do
        echo ln -sf \$(echo \$(echo \$l | sed 's|/[^/]*|/..|g')\$(readlink \$l) | sed 's/.....//') \$l
      done |
      sh
      EOF
      chmod +x $SNAPCRAFT_PART_INSTALL/fix-symlinks.sh
    prime:
    - -*

  patches:
    plugin: dump
    source: patches
    prime:
    - -*

  desktop-launch:
    after:
    - adwaita-icon-theme
    - gnome-icon-theme
    - gnome-icon-theme-extras
    - gnome-icon-theme-symbolic
    - gnome-themes-standard
    - hicolor-icon-theme
    - gtk2
    - shared-mime-info
    plugin: dump
    source: scripts
    prepare: |
      chmod +x desktop-launch
    organize:
      desktop-launch: bin/desktop-launch
    stage-packages:
    - dmz-cursor-theme
    - libxkbcommon0
    - locales-all
    - ttf-ubuntu-font-family

  alsa:
    after: [alsa-lib, alsa-plugins]
  alsa-plugins:
    after: [alsa-lib, pulseaudio]
    build-packages: []
    stage-packages: []
    stage:
    - usr/lib
    - usr/share/alsa

  # https://download.gnome.org/sources/adwaita-icon-theme
  adwaita-icon-theme:
    after:
    - librsvg
    source: https://download.gnome.org/sources/adwaita-icon-theme/3.28/adwaita-icon-theme-3.28.0.tar.xz
    source-checksum: sha256/7aae8c1dffd6772fd1a21a3d365a0ea28b7c3988bdbbeafbf8742cda68242150
    plugin: autotools
    configflags:
    - --prefix=/usr
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      ./configure --prefix=/usr
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
    build-packages:
    - intltool

  # https://download.gnome.org/sources/at-spi2-core
  atspi2:
    after:
    - fix-pkgconfig-files
    - gobject-introspection
    source: https://download.gnome.org/sources/at-spi2-core/2.28/at-spi2-core-2.28.0.tar.xz
    source-checksum: sha256/42a2487ab11ce43c288e73b2668ef8b1ab40a0e2b4f94e80fca04ad27b6f1c87
    plugin: meson
    build-packages:
    - libdbus-1-dev
    - libx11-dev
    - libxi-dev
    - libxkbcommon-dev
    - libxtst-dev
    - python3-pip
    - python3-setuptools
    meson-parameters:
    - --prefix=/usr
    - --buildtype=release
    override-build: |
      pip3 install meson
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      meson --prefix=/usr --buildtype=release snapbuild
      cd snapbuild
      ninja
      env DESTDIR=$SNAPCRAFT_PART_INSTALL ninja install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libdbus-1-3
    - libx11-6
    - libxi6
    - libxkbcommon-x11-0
    - libxtst6

  # https://download.gimp.org/pub/babl
  babl:
    after:
    - fix-pkgconfig-files
    plugin: autotools
    source: https://download.gimp.org/pub/babl/0.1/babl-0.1.52.tar.bz2
    source-checksum: sha256/40f714a0fc043e16ac05c670f39e4db0d0d923480d21952fb0569686479ef76c
    configflags:
    - --prefix=/usr
    - --disable-docs
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://cairographics.org/releases or https://cairographics.org/snapshots
  cairo:
    after:
    - fix-pkgconfig-files
    - fontconfig
    - glib
    - libpng
    - pixman
    source: https://cairographics.org/snapshots/cairo-1.15.12.tar.xz
    source-checksum: sha1/4e64c6a48789edb4c60bc3fa95bd3992cc388b88
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  darktable:
    after:
    - cairo
    - dbus-glib
    - glib
    - graphicsmagick
    - gtk3
    - json-glib
    - lcms2
    - liblensfun
    - libpng
    - librsvg
    - libsecret
    - libsoup
    - libwebp
    - osmgpsmap
    source: https://github.com/darktable-org/darktable/releases/download/release-2.4.3/darktable-2.4.3.tar.xz
    plugin: cmake
    configflags:
    - -DCMAKE_INSTALL_PREFIX=/usr
    - -DCMAKE_BUILD_TYPE=Release
    - -DDONT_USE_INTERNAL_LUA=Off
    - -DBINARY_PACKAGE_BUILD=On
    build-packages:
    - curl
    - intltool
    - libexiv2-dev
    - libflickcurl-dev
    - libjpeg8-dev
    - libopenexr-dev
    - libopenjp2-7-dev
    - libpugixml-dev
    - libsqlite3-dev
    - libtiff5-dev
    - libxml2-utils
    - libxml2-dev
    - xsltproc
    stage-packages:
    - curl
    - libexiv2-14
    - libflickcurl0
    - libjpeg8
    - libopenexr22
    - libopenjp2-7
    - libpugixml1v5
    - libsqlite3-0
    - libtiff5
    - libxml2

  # https://dbus.freedesktop.org/releases/dbus-glib
  dbus-glib:
    after:
    - glib
    source: https://dbus.freedesktop.org/releases/dbus-glib/dbus-glib-0.110.tar.gz
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --sysconfdir=/etc
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    build-packages:
    - libdbus-1-dev
    stage-packages:
    - libdbus-1-3

  # https://www.freedesktop.org/software/fontconfig/release
  fontconfig:
    after:
    - fix-pkgconfig-files
    - fix-symlinks
    - freetype
    source: https://www.freedesktop.org/software/fontconfig/release/fontconfig-2.13.0.tar.bz2
    plugin: autotools
    build-packages:
    - gperf
    configflags:
    - --prefix=/usr
    - --sysconfdir=/etc
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
      $SNAPCRAFT_STAGE/fix-symlinks.sh
    stage:
    - -usr/var

  # https://download.savannah.gnu.org/releases/freetype
  freetype-prebuild:
    after:
    - fix-pkgconfig-files
    source: https://download.savannah.gnu.org/releases/freetype/freetype-2.9.1.tar.bz2
    plugin: autotools
    configflags:
    - --prefix=/usr/local
    - --without-harfbuzz
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    prime:
    - -*

  # https://download.savannah.gnu.org/releases/freetype
  freetype:
    after:
    - fix-pkgconfig-files
    - harfbuzz
    source: https://download.savannah.gnu.org/releases/freetype/freetype-2.9.1.tar.bz2
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  #Â https://download.gnome.org/sources/gdk-pixbuf
  gdk-pixbuf:
    after:
    - fix-pkgconfig-files
    - glib
    - gobject-introspection
    - jasper
    - libpng
    - shared-mime-info
    source: https://download.gnome.org/sources/gdk-pixbuf/2.36/gdk-pixbuf-2.36.12.tar.xz
    source-checksum: sha256/fff85cf48223ab60e3c3c8318e2087131b590fd6f1737e42cb3759a3b427a334
    plugin: autotools
    build-packages:
    - libjpeg8-dev
    - libtiff5-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    - --enable-relocatable=true
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      ./configure --prefix=/usr --disable-static --enable-relocations
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
      sed -i "s|Exec=/usr/bin/|Exec=/snap/$SNAPCRAFT_PROJECT_NAME/current/usr/bin/|g" $SNAPCRAFT_PART_INSTALL/usr/share/thumbnailers/gdk-pixbuf-thumbnailer.thumbnailer
    stage-packages:
    - libjpeg8
    - libtiff5

  # https://download.gimp.org/pub/gegl
  gegl:
    after:
    - babl
    - cairo
    - fix-pkgconfig-files
    - gdk-pixbuf
    - gettext
    - gexiv2
    - glib
    - gobject-introspection
    - graphviz
    - gtk2
    - jasper
    - json-glib
    - lcms2
    - libheif
    - liblensfun
    - libpng
    - librsvg
    - libwebp
    - pango
    - pygobject
    - vala
    source: https://download.gimp.org/pub/gegl/0.4/gegl-0.4.4.tar.bz2
    source-checksum: sha256/f8cb45da736131fe29582b74cf6851102ae013bf99c77413a8bcb02e92e57890
    plugin: autotools
    build-packages:
    - libexiv2-dev
    - libfftw3-dev
    - libjpeg8-dev
    - libopenexr-dev
    - libraw-dev
    - libspiro-dev
    - libsuitesparse-dev
    - libtiff5-dev
    configflags:
    - --prefix=/usr
    - --disable-docs
    - --disable-rpath
    - --disable-static
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      export GIO_MODULE_DIR=$SNAPCRAFT_STAGE/usr/lib/gio/modules
      ./configure --prefix=/usr --disable-docs --disable-rpath --disable-static
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libamd2.4.1
    - libbtf1.2.1
    - libcamd2.4.1
    - libccolamd2.9.1
    - libcholmod3.0.6
    - libcolamd2.9.1
    - libcsparse3.1.4
    - libcxsparse3.1.4
    - libexiv2-14
    - libjpeg8
    - libopenexr22
    - libraw15
    - libspiro0
    - libspqr2.0.2
    - libtiff5
    - libumfpack5.7.1

  # https://ftp.gnu.org/pub/gnu/gettext
  gettext:
    after:
    - fix-pkgconfig-files
    - glib
    - libcroco
    source: https://ftp.gnu.org/pub/gnu/gettext/gettext-0.19.8.1.tar.xz
    plugin: autotools
    build-packages:
    - bison
    - libunistring-dev
    - libxml2-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    - --disable-curses
    - --disable-java
    - --enable-relocatable
    - --without-emacs
    - --without-included-glib
    - --without-included-libunistring
    - --without-included-libxml
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libunistring0
    - libxml2

  # https://download.gnome.org/sources/gexiv2
  gexiv2:
    after:
    - fix-pkgconfig-files
    - glib
    - gobject-introspection
    - gtk2
    - gtk3
    - vala
    source: https://download.gnome.org/sources/gexiv2/0.10/gexiv2-0.10.8.tar.xz
    source-checksum: sha256/81c528fd1e5e03577acd80fb77798223945f043fd1d4e06920c71202eea90801
    plugin: autotools
    build-packages:
    - libexiv2-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    - --disable-gtk-doc
    - --disable-gtk-doc-html
    - --disable-gtk-doc-pdf
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      ./configure --prefix=/usr --disable-static --disable-gtk-doc --disable-gtk-doc-html --disable-gtk-doc-pdf
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libexiv2-14

  # https://download.gnome.org/sources/glib
  glib:
    after:
    - fix-pkgconfig-files
    source: https://download.gnome.org/sources/glib/2.57/glib-2.57.1.tar.xz
    source-checksum: sha256/d029e7c4536835f1f103472f7510332c28d58b9b7d6cd0e9f45c2653e670d9b4
    plugin: meson
    build-packages:
    - libmount-dev
    - libpcre3-dev
    - libselinux1-dev
    - python-dev
    - zlib1g-dev
    meson-parameters:
    - --prefix=/usr
    - --buildtype=release
    override-build: |
      pip3 install meson
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage:
    - -usr/lib/python2.7/sitecustomize.py
    stage-packages:
    - libmount1
    - libpcre3
    - libselinux1
    - zlib1g

  # https://download.gnome.org/sources/glib-networking
  glib-networking:
    after:
    - fix-pkgconfig-files
    - glib
    - gsettings-desktop-schemas
    plugin: meson
    source: https://download.gnome.org/sources/glib-networking/2.57/glib-networking-2.57.1.tar.xz
    source-checksum: sha256/663878443c636aa0af5b6708ddf715d82effe961989972cb9a1f48d2a3ecb026
    build-packages:
    - libgnutls-dev
    - libproxy-dev
    - python3-pip
    - python3-setuptools
    meson-parameters:
    - --prefix=/usr
    - --buildtype=release
    override-build: |
      pip3 install meson
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    organize:
      root/build_gimp/stage/usr/lib/gio/modules/*: usr/lib/gio/modules/
    stage:
    - -root
    stage-packages:
    - libgnutls30
    - libproxy1v5

  # https://download.gnome.org/sources/gnome-icon-theme
  gnome-icon-theme:
    after:
    - gtk2
    - hicolor-icon-theme
    - librsvg
    source: https://download.gnome.org/sources/gnome-icon-theme/2.31/gnome-icon-theme-2.31.0.tar.bz2
    source-checksum: sha256/ea7e05b77ead159379392b3b275ca0c9cbacd7d936014e447cc7c5e27a767982
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --enable-icon-mapping
    build-packages:
    - icon-naming-utils
    - intltool

  # https://download.gnome.org/sources/gnome-icon-theme-extras
  gnome-icon-theme-extras:
    after:
    - gnome-icon-theme
    - gtk2
    - hicolor-icon-theme
    - librsvg
    source: https://download.gnome.org/sources/gnome-icon-theme-extras/3.12/gnome-icon-theme-extras-3.12.0.tar.xz
    source-checksum: sha256/4eec6cea8a7b09c4ed6ebab1a3b42539b9c61a53bec4b8872e774611cc619608
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --enable-icon-mapping
    build-packages:
    - icon-naming-utils
    - intltool

  # https://download.gnome.org/sources/gnome-icon-theme-symbolic
  gnome-icon-theme-symbolic:
    after:
    - gnome-icon-theme
    - gtk2
    - hicolor-icon-theme
    - librsvg
    source: https://download.gnome.org/sources/gnome-icon-theme-symbolic/3.12/gnome-icon-theme-symbolic-3.12.0.tar.xz
    source-checksum: sha256/851a4c9d8e8cb0000c9e5e78259ab8b8e67c5334e4250ebcc8dfdaa33520068b
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --enable-icon-mapping
    build-packages:
    - icon-naming-utils
    - intltool

  # https://download.gnome.org/sources/gnome-themes-standard
  gnome-themes-standard:
    after:
    - gettext
    - glib
    - gtk2
    - gtk3
    - librsvg
    source: https://download.gnome.org/sources/gnome-themes-standard/3.22/gnome-themes-standard-3.22.3.tar.xz
    source-checksum: sha256/61dc87c52261cfd5b94d65e8ffd923ddeb5d3944562f84942eeeb197ab8ab56a
    plugin: autotools
    configflags:
    - --prefix=/usr

  # https://download.gnome.org/sources/gobject-introspection
  gobject-introspection:
    after:
    - fix-pkgconfig-files
    - glib
    - patches
    plugin: autotools
    source: https://download.gnome.org/sources/gobject-introspection/1.56/gobject-introspection-1.56.1.tar.xz
    source-checksum: sha256/5b2875ccff99ff7baab63a34b67f8c920def240e178ff50add809e267d9ea24b
    build-packages:
    - bison
    - flex
    - libffi-dev
    - patch
    - python-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    - --with-python=python
    disable-parallel: true
    override-build: |
      patch -Np1 < $SNAPCRAFT_STAGE/gobject-introspection.patch
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage:
    - -root
    - -usr/lib/python2.7/sitecustomize.py
    stage-packages:
    - libffi6

  graphicsmagick:
    after:
    - fix-pkgconfig-files
    - freetype
    - lcms2
    - libpng
    - libwebp
    source: http://sourceforge.mirrorservice.org/g/gr/graphicsmagick/graphicsmagick/1.3.28/GraphicsMagick-1.3.28.tar.xz
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --enable-shared
    - --disable-static
    build-packages:
    - libbz2-dev
    - libjbig-dev
    - libjpeg8-dev
    - liblzma-dev
    - libtiff5-dev
    - libxml2-dev
    - zlib1g-dev
    stage-packages:
    - libbz2-1.0
    - libjbig0
    - libjpeg8
    - liblzma5
    - libtiff5
    - libxml2
    - zlib1g

  # https://graphviz.gitlab.io/_pages/Download/Download_source.html
  graphviz:
    after:
    - cairo
    - fix-pkgconfig-files
    - fontconfig
    - gtk2
    - libpng
    - librsvg
    - libwebp
    - pango
    - poppler
    source: https://graphviz.gitlab.io/pub/graphviz/stable/SOURCES/graphviz.tar.gz
    source-checksum: md5/4ea6fd64603536406166600bcc296fc8
    plugin: autotools
    build-packages:
    - libjpeg8-dev
    - libltdl-dev
    - libxcb1-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libjpeg8
    - libltdl7
    - libxcb1

  # https://download.gnome.org/sources/gsettings-desktop-schemas
  gsettings-desktop-schemas:
    after:
    - fix-pkgconfig-files
    - gettext
    - glib
    - gobject-introspection
    plugin: autotools
    source: https://download.gnome.org/sources/gsettings-desktop-schemas/3.28/gsettings-desktop-schemas-3.28.0.tar.xz
    source-checksum: sha256/4cb4cd7790b77e5542ec75275237613ad22f3a1f2f41903a298cf6cc996a9167
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      ./configure --prefix=/usr --disable-static
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://download.gnome.org/sources/gtk+
  gtk2:
    after:
    - cairo
    - fix-pkgconfig-files
    - fontconfig
    - gdk-pixbuf
    - gettext
    - glib
    - gobject-introspection
    - libatk
    - pango
    source: https://download.gnome.org/sources/gtk+/2.24/gtk+-2.24.32.tar.xz
    source-checksum: sha256/b6c8a93ddda5eabe3bfee1eb39636c9a03d2a56c7b62828b359bf197943c582e
    plugin: autotools
    build-packages:
    - libcups2-dev
    - libx11-dev
    - libxcomposite-dev
    - libxdamage-dev
    - libxfixes-dev
    - libxi-dev
    - libxinerama-dev
    - libxrandr-dev
    - libxrender-dev
    configflags:
    - --prefix=/usr
    - --sysconfdir=/etc
    - --disable-static
    - --with-xinput
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      export GDK_PIXBUF_MODULEDIR=$SNAPCRAFT_STAGE/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders
      $SNAPCRAFT_STAGE/usr/bin/gdk-pixbuf-query-loaders > $SNAPCRAFT_STAGE/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache
      ./configure --prefix=/usr --sysconfdir=/etc --disable-static --with-xinput
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage:
    - -usr/bin/gtk-update-icon-cache
    stage-packages:
    - libcups2
    - libx11-6
    - libxcomposite1
    - libxdamage1
    - libxfixes3
    - libxi6
    - libxinerama1
    - libxrandr2
    - libxrender1

  # https://download.gnome.org/sources/gtk+
  gtk3:
    after:
    - cairo
    - fix-pkgconfig-files
    - fontconfig
    - gdk-pixbuf
    - gettext
    - glib
    - gobject-introspection
    - json-glib
    - libatk
    - libatk-bridge
    - libepoxy
    - pango
    source: https://download.gnome.org/sources/gtk+/3.22/gtk+-3.22.29.tar.xz
    source-checksum: sha256/a07d64b939fcc034a066b7723fdf9b24e92c9cfb6a8497593f3471fe56fbbbf8
    plugin: autotools
    build-packages:
    - libcups2-dev
    - libwayland-dev
    - libx11-dev
    - libxcomposite-dev
    - libxdamage-dev
    - libxfixes-dev
    - libxi-dev
    - libxinerama-dev
    - libxrandr-dev
    - libxrender-dev
    - wayland-protocols
    configflags:
    - --prefix=/usr
    - --disable-static
    - --enable-x11-backend
    - --enable-wayland-backend
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      export GDK_PIXBUF_MODULEDIR=$SNAPCRAFT_STAGE/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders
      $SNAPCRAFT_STAGE/usr/bin/gdk-pixbuf-query-loaders > $SNAPCRAFT_STAGE/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache
      ./configure --prefix=/usr --disable-static --enable-x11-backend --enable-wayland-backend
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libcups2
    - libwayland-client0
    - libwayland-cursor0
    - libwayland-egl1-mesa
    - libx11-6
    - libxcomposite1
    - libxdamage1
    - libxfixes3
    - libxi6
    - libxinerama1
    - libxrandr2
    - libxrender1

  gtk-engines:
    after:
    - fix-pkgconfig-files
    - gtk2
    source: http://ftp.gnome.org/pub/gnome/sources/gtk-engines/2.20/gtk-engines-2.20.2.tar.bz2
    source-checksum: sha256/15b680abca6c773ecb85253521fa100dd3b8549befeecc7595b10209d62d66b5
    plugin: autotools
    configflags:
    - --prefix=/usr
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # gvfs:
  #   after:
  #   - fix-pkgconfig-files
  #   - glib
  #   - gobject-introspection
  #   - gtk3
  #   - libgcrypt
  #   - libsoup
  #   source: http://ftp.gnome.org/pub/gnome/sources/gvfs/1.37/gvfs-1.37.2.tar.xz
  #   source-checksum: sha256/bf1c533d797707f6b5cca693e50ff200f05d2dd2ee155bb6c76ef6d3e72bb94a
  #   plugin: meson
  #   meson-parameters:
  #   - --prefix=/usr
  #   - --buildtype=release
  #   - -Dgcr=false
  #   - -Dgphoto2=false
  #   override-build: |
  #     snapcraftctl build
  #     $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
  #   build-packages:
  #   - libcap-dev
  #   - libdbus-1-dev
  #   - libxml2-dev
  #   stage-packages:
  #   - libcap2
  #   - libdbus-1-3
  #   - libxml2

  # https://www.freedesktop.org/software/harfbuzz/release
  harfbuzz:
    after:
    - fix-pkgconfig-files
    - freetype-prebuild
    - glib
    - gobject-introspection
    source: https://www.freedesktop.org/software/harfbuzz/release/harfbuzz-1.7.6.tar.bz2
    source-checksum: sha256/da7bed39134826cd51e57c29f1dfbe342ccedb4f4773b1c951ff05ff383e2e9b
    plugin: autotools
    build-packages:
    - libicu-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    - --with-cairo=no
    override-build: |
      apt-get remove -yyq libfreetype6
      ln -s $SNAPCRAFT_STAGE/usr/local/lib/libfreetype.so \
        $SNAPCRAFT_STAGE/usr/local/lib/libfreetype.so.6 \
        $SNAPCRAFT_PART_INSTALL/usr/lib/
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
      rm -f $SNAPCRAFT_PART_INSTALL/usr/lib/libfreetype.so*
    stage-packages:
    - libicu55

  # https://icon-theme.freedesktop.org/releases
  hicolor-icon-theme:
    source: https://icon-theme.freedesktop.org/releases/hicolor-icon-theme-0.17.tar.xz
    plugin: autotools
    configflags:
    - --prefix=/usr

  # http://www.ece.uvic.ca/~frodo/jasper
  jasper:
    after:
    - fix-pkgconfig-files
    plugin: cmake
    source: https://www.ece.uvic.ca/~frodo/jasper/software/jasper-2.0.14.tar.gz
    build-packages:
    - libgl1-mesa-dev
    - libjpeg8-dev
    configflags:
    - -DCMAKE_INSTALL_PREFIX=/usr
    - -DCMAKE_BUILD_TYPE=release
    - -DJAS_ENABLE_LIBJPEG=true
    - -DJAS_ENABLE_OPENGL=true
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libgl1-mesa-glx
    - libjpeg8

  # https://download.gnome.org/sources/json-glib
  json-glib:
    after:
    - fix-pkgconfig-files
    - glib
    - gobject-introspection
    plugin: meson
    source: https://download.gnome.org/sources/json-glib/1.4/json-glib-1.4.2.tar.xz
    source-checksum: sha256/2d7709a44749c7318599a6829322e081915bdc73f5be5045882ed120bb686dc8
    build-packages:
    - python3-pip
    - python3-setuptools
    meson-parameters:
    - --prefix=/usr
    - --buildtype=release
    - -Ddocs=false
    override-build: |
      pip3 install meson
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      meson --prefix=/usr --buildtype=release -Ddocs=false snapbuild
      cd snapbuild
      ninja
      env DESTDIR=$SNAPCRAFT_PART_INSTALL ninja install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://github.com/mm2/Little-CMS/releases
  lcms2:
    after:
    - fix-pkgconfig-files
    plugin: autotools
    source: https://github.com/mm2/Little-CMS/archive/lcms2.9.tar.gz
    build-packages:
    - libjpeg8-dev
    - libtiff5-dev
    - zlib1g-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libjpeg8
    - libtiff5
    - zlib1g

  # https://download.gnome.org/sources/atk
  libatk:
    after:
    - fix-pkgconfig-files
    - gobject-introspection
    source: https://download.gnome.org/sources/atk/2.29/atk-2.29.1.tar.xz
    source-checksum: sha256/1aa7707c6297c1797fe4d79a22a57ede4d5586b0f7a3b30e886d7ca9d75f20da
    plugin: meson
    build-packages:
    - libdbus-1-dev
    - python3-pip
    - python3-setuptools
    meson-parameters:
    - --prefix=/usr
    - --buildtype=release
    override-build: |
      pip3 install meson
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      meson --prefix=/usr --buildtype=release snapbuild
      cd snapbuild
      ninja
      env DESTDIR=$SNAPCRAFT_PART_INSTALL ninja install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libdbus-1-3

  # https://download.gnome.org/sources/at-spi2-atk
  libatk-bridge:
    after:
    - atspi2
    - fix-pkgconfig-files
    - libatk
    source: https://download.gnome.org/sources/at-spi2-atk/2.26/at-spi2-atk-2.26.2.tar.xz
    source-checksum: sha256/61891f0abae1689f6617a963105a3f1dcdab5970c4a36ded9c79a7a544b16a6e
    plugin: meson
    build-packages:
    - libdbus-1-dev
    - python3-pip
    - python3-setuptools
    meson-parameters:
    - --prefix=/usr
    - --buildtype=release
    override-build: |
      pip3 install meson
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      meson --prefix=/usr --buildtype=release snapbuild
      cd snapbuild
      ninja
      env DESTDIR=$SNAPCRAFT_PART_INSTALL ninja install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libdbus-1-3

  # https://github.com/google/brotli/releases
  libbrotli:
    after:
    - fix-pkgconfig-files
    source: https://github.com/google/brotli/archive/v1.0.4.tar.gz
    plugin: cmake
    configflags:
    - -DCMAKE_INSTALL_PREFIX=/usr
    - -DCMAKE_BUILD_TYPE=Release
    # - -DBROTLI_DISABLE_TESTS
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://download.gnome.org/sources/libcroco
  libcroco:
    after:
    - fix-pkgconfig-files
    - glib
    source: https://download.gnome.org/sources/libcroco/0.6/libcroco-0.6.12.tar.xz
    source-checksum: sha256/ddc4b5546c9fb4280a5017e2707fbd4839034ed1aba5b7d4372212f34f84f860
    plugin: autotools
    build-packages:
    - libxml2-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libxml2

  # https://download.gnome.org/sources/libepoxy
  libepoxy:
    after:
    - fix-pkgconfig-files
    source: https://download.gnome.org/sources/libepoxy/1.5/libepoxy-1.5.0.tar.xz
    source-checksum: sha256/4c94995398a6ebf691600dda2e9685a0cac261414175c2adf4645cdfab42a5d5
    plugin: autotools
    build-packages:
    - libegl1-mesa-dev
    configflags:
    - --prefix=/usr
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libegl1-mesa

  # https://gnupg.org/ftp/gcrypt/libgcrypt
  libgcrypt:
    after:
    - fix-pkgconfig-files
    - gettext
    - libgpg-error
    source: https://gnupg.org/ftp/gcrypt/libgcrypt/libgcrypt-1.8.2.tar.bz2
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --disable-doc
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://gnupg.org/ftp/gcrypt/libgpg-error
  libgpg-error:
    after:
    - fix-pkgconfig-files
    - gettext
    source: https://gnupg.org/ftp/gcrypt/libgpg-error/libgpg-error-1.28.tar.bz2
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --disable-doc
    - --disable-tests
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  libheif:
    after:
    - fix-pkgconfig-files
    - libpng
    source: https://github.com/strukturag/libheif/releases/download/v1.3.2/libheif-1.3.2.tar.gz
    plugin: autotools
    configflags:
    - --prefix=/usr
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    build-packages:
    - libde265-dev
    - libjpeg8-dev
    - libx265-dev
    stage-packages:
    - libde265-0
    - libjpeg8
    - libx265-79

  # https://sourceforge.net/projects/lensfun/files
  liblensfun:
    after:
    - fix-pkgconfig-files
    - glib
    - gobject-introspection
    plugin: cmake
    source: https://sourceforge.mirrorservice.org/l/le/lensfun/0.3.2/lensfun-0.3.2.tar.gz
    configflags:
    - -DCMAKE_INSTALL_PREFIX=/usr
    - -DCMAKE_BUILD_TYPE=Release
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  libmng:
    after:
    - fix-pkgconfig-files
    - lcms2
    source: https://downloads.sourceforge.net/libmng/libmng-2.0.3.tar.xz
    source-checksum: md5/e9e899adb1b681b17f14d91e261878c5
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --disable-static
    build-packages:
    - libjpeg8-dev
    stage-packages:
    - libjpeg8

  # https://github.com/mypaint/libmypaint/releases
  libmypaint:
    after:
    - fix-pkgconfig-files
    - gettext
    - glib
    - gobject-introspection
    - json-glib
    plugin: autotools
    source: https://github.com/mypaint/libmypaint/releases/download/v1.3.0/libmypaint-1.3.0.tar.xz
    source-checksum: sha256/6a07d9d57fea60f68d218a953ce91b168975a003db24de6ac01ad69dcc94a671
    build-packages:
    - intltool
    - libjson-c-dev
    # - python
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      ./configure --prefix=/usr --disable-static
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # http://sourceforge.mirrorservice.org/l/li/libpng/libpng16
  libpng:
    after:
    - fix-pkgconfig-files
    plugin: autotools
    source: http://sourceforge.mirrorservice.org/l/li/libpng/libpng16/1.6.34/libpng-1.6.34.tar.xz
    source-checksum: md5/c05b6ca7190a5e387b78657dbe5536b2
    build-packages:
    - zlib1g-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - zlib1g

  #Â https://download.gnome.org/sources/librsvg
  librsvg:
    after:
    - fix-pkgconfig-files
    - fontconfig
    - gdk-pixbuf
    - gobject-introspection
    - libcroco
    - pango
    - vala
    source: https://download.gnome.org/sources/librsvg/2.42/librsvg-2.42.4.tar.xz
    source-checksum: sha256/225280a2a69ee4cce6452a1a92d9297cc1b34a8faface2bf2b4b9da48f044de3
    plugin: autotools
    build-packages:
    - cargo
    - libxml2-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    - --enable-pixbuf-loader
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      ./configure --prefix=/usr --disable-static --enable-pixbuf-loader
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
      sed -i "s|Exec=/usr/bin/|Exec=/snap/$SNAPCRAFT_PROJECT_NAME/current/usr/bin/|g" $SNAPCRAFT_PART_INSTALL/usr/share/thumbnailers/librsvg.thumbnailer
    stage-packages:
    - libxml2
    organize:
      root/build_gimp/stage/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders/*: usr/lib/gdk-pixbuf-2.0/2.10.0/loaders/
    stage:
    - -root

  # https://download.gnome.org/sources/libsecret
  libsecret:
    after:
    - fix-pkgconfig-files
    - gettext
    - glib
    - gobject-introspection
    - libgcrypt
    - vala
    source: https://download.gnome.org/sources/libsecret/0.18/libsecret-0.18.tar.xz
    source-checksum: sha256/0c73aa762dbd1e38ba7b03de350e23ce818cb810b0784375e95ef61e004b02e3
    plugin: autotools
    build-packages:
    - intltool
    configflags:
    - --prefix=/usr
    - --disable-manpages
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      ./configure --prefix=/usr --disable-manpages
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://download.gnome.org/sources/libsoup
  libsoup:
    after:
    - fix-pkgconfig-files
    - glib-networking
    - gobject-introspection
    - vala
    source: https://download.gnome.org/sources/libsoup/2.62/libsoup-2.62.0.tar.xz
    source-checksum: sha256/ab7c7ae8d19d0a27ab3b6ae21599cec8c7f7b773b3f2b1090c5daf178373aaac
    plugin: autotools
    build-packages:
    - libsqlite3-dev
    - libxml2-dev
    configflags:
    - --prefix=/usr
    - --without-gnome
    - --disable-tls-check
    - --disable-static
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      ./configure --prefix=/usr --without-gnome --disable-tls-check --disable-static
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libsqlite3-0
    - libxml2
    organize:
      root/build_gimp/stage/usr/share/vala/vapi/*: usr/share/vala/vapi/
    stage:
    - -root

  # https://chromium.googlesource.com/webm/libwebp
  libwebp:
    after:
    - fix-pkgconfig-files
    plugin: autotools
    source: https://chromium.googlesource.com/webm/libwebp.git
    source-type: git
    source-tag: v1.0.0
    source-depth: 1
    configflags:
    - --prefix=/usr
    - --disable-static
    - --enable-libwebpmux
    - --enable-libwebpdemux
    - --enable-libwebpdecoder
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://github.com/Jehan/mypaint-brushes/releases
  mypaint-brushes:
    after:
    - libmypaint
    source: https://github.com/Jehan/mypaint-brushes/archive/v1.3.0.tar.gz
    plugin: autotools
    configflags:
    - --prefix=/usr

  osmgpsmap:
    after:
    - fix-pkgconfig-files
    - cairo
    - gobject-introspection
    - gtk3
    - libsoup
    - pycairo
    - pygobject
    - pygtk
    source: https://github.com/nzjrs/osm-gps-map/releases/download/1.1.0/osm-gps-map-1.1.0.tar.gz
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      export PYTHON=/usr/bin/python
      ./configure --prefix=/usr --disable-static
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://download.gnome.org/sources/pango
  pango:
    after:
    - cairo
    - fix-pkgconfig-files
    - fontconfig
    - glib
    - gobject-introspection
    - shared-mime-info
    source: https://download.gnome.org/sources/pango/1.42/pango-1.42.1.tar.xz
    source-checksum: sha256/915a6756b298578ff27c7a6393f8c2e62e6e382f9411f2504d7af1a13c7bce32
    plugin: autotools
    build-packages:
    - libfribidi-dev
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      ./configure --prefix=/usr --disable-static
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libfribidi0

  # https://www.cairographics.org/releases/
  pixman:
    after:
    - fix-pkgconfig-files
    source: https://www.cairographics.org/releases/pixman-0.34.0.tar.gz
    source-checksum: sha1/a1b1683c1a55acce9d928fea1ab6ceb79142ddc7
    plugin: autotools
    configflags:
    - --prefix=/usr
    - --disable-static
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://poppler.freedesktop.org/
  poppler:
    after:
    - cairo
    - fix-pkgconfig-files
    - fontconfig
    - glib
    - gobject-introspection
    - lcms2
    source: https://poppler.freedesktop.org/poppler-0.65.0.tar.xz
    plugin: cmake
    configflags:
    - -DCMAKE_INSTALL_PREFIX=/usr
    - -DCMAKE_BUILD_TYPE=Release
    - -DENABLE_CMS=lcms2
    - -DENABLE_RELOCATABLE=ON
    - -DENABLE_GLIB=ON
    - -DENABLE_GOBJECT_INTROSPECTION=ON
    - -DENABLE_QT5=OFF
    build-packages:
    - libopenjp2-7-dev
    - zlib1g-dev
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      export GIO_MODULE_DIR=$SNAPCRAFT_STAGE/usr/lib/gio/modules
      cmake ../src -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release -DENABLE_CMS=lcms2 -DENABLE_RELOCATABLE=ON -DENABLE_GLIB=ON -DENABLE_QT5=OFF
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libopenjp2-7
    - zlib1g

  # https://poppler.freedesktop.org/
  poppler-data:
    after:
    - poppler
    source: https://poppler.freedesktop.org/poppler-data-0.4.9.tar.gz
    plugin: cmake
    configflags:
    - -DCMAKE_INSTALL_PREFIX=/usr
    - -DCMAKE_BUILD_TYPE=Release

  # https://freedesktop.org/software/pulseaudio/releases
  pulseaudio:
    after:
    - fix-pkgconfig-files
    - glib
    plugin: autotools
    source: https://freedesktop.org/software/pulseaudio/releases/pulseaudio-11.1.tar.xz
    source-checksum: sha1/53bde72b6bfe715c19b1519db8845f7a58346b67
    build-packages:
    - libsndfile1-dev
    configflags:
    - --prefix=/usr
    - --sysconfdir=/etc
    - --disable-static
    - --without-caps
    - --without-fftw
    - --without-speex
    - --without-soxr
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libsndfile1

  # https://github.com/pygobject/pycairo/releases
  pycairo:
    after:
    - cairo
    plugin: python
    python-version: python2
    source: https://github.com/pygobject/pycairo/releases/download/v1.17.0/pycairo-1.17.0.tar.gz
    source-checksum: sha256/cdd4d1d357325dec3a21720b85d273408ef83da5f15c184f2eff3212ff236b9f
    build-packages:
    - libxcb-render0-dev
    - python-pip
    - python-setuptools
    stage-packages:
    - libxcb-render0

  # https://download.gnome.org/sources/pygobject
  pygobject:
    after:
    - cairo
    - fix-pkgconfig-files
    - glib
    - pycairo
    plugin: autotools
    source: https://download.gnome.org/sources/pygobject/2.28/pygobject-2.28.7.tar.xz
    source-checksum: sha256/bb9d25a3442ca7511385a7c01b057492095c263784ef31231ffe589d83a96a5a
    build-packages:
    - python-dev
    configflags:
    - --prefix=/usr
    - --enable-cairo
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      export PYTHON=/usr/bin/python
      ./configure --prefix=/usr --enable-cairo
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://download.gnome.org/sources/pygtk
  pygtk:
    after:
    - cairo
    - fix-pkgconfig-files
    - glib
    - gobject-introspection
    - gtk2
    - libatk
    - pango
    - pycairo
    - pygobject
    plugin: autotools
    source: https://download.gnome.org/sources/pygtk/2.24/pygtk-2.24.0.tar.bz2
    source-checksum: sha256/cd1c1ea265bd63ff669e92a2d3c2a88eb26bcd9e5363e0f82c896e649f206912
    build-packages:
    - python-dev
    configflags:
    - --prefix=/usr
    override-build: |
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      export PYTHON=/usr/bin/python
      ./configure --prefix=/usr
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh

  # https://freedesktop.org/wiki/Software/shared-mime-info
  shared-mime-info:
    after:
    - glib
    - gobject-introspection
    source: http://freedesktop.org/~hadess/shared-mime-info-1.9.tar.xz
    plugin: autotools
    disable-parallel: true
    build-packages:
    - libxml2-dev
    - libxml2-utils
    configflags:
    - --prefix=/usr
    - --disable-update-mimedb
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    stage-packages:
    - libxml2

  # https://wiki.gnome.org/Projects/Vala/Release
  vala:
    after:
    - fix-pkgconfig-files
    - glib
    plugin: autotools
    source: https://download.gnome.org/sources/vala/0.38/vala-0.38.9.tar.xz
    source-checksum: sha256/c3ba214dd2bf981d646d57adfed0ce69600b2ba6c942dea1c93630ed98c201b6
    build-packages:
    - bison
    - flex
    configflags:
    - --prefix=/usr
    override-pull: |
      snapcraftctl pull
      # allow building without graphviz
      sed -i '102d; 108,124d; 126,127d' configure.ac
      sed -i '/valadoc/d' Makefile.am
      ACLOCAL= autoreconf -fiv
    override-build: |
      snapcraftctl build
      $SNAPCRAFT_STAGE/fix-pkgconfig-files.sh
    prime: [-*]

  # https://www.gimp.org/downloads
  gimp:
    after:
    - darktable
    - desktop-launch
    - alsa
    - gegl
    - gettext
    - gexiv2
    - glib
    - glib-networking
    - gtk2
    - gtk-engines
    - jasper
    - lcms2
    - libmng
    - libmypaint
    - libpng
    - librsvg
    - libwebp
    - mypaint-brushes
    - poppler-data
    - pygtk
    plugin: autotools
    source: https://download.gimp.org/pub/gimp/v2.10/gimp-$SNAPCRAFT_PROJECT_VERSION.tar.bz2
    source-checksum: sha256/ffb0768de14a2631b3d7ed71f283731441a1b48461766c23f0574dce0706f192
    configflags:
    - --prefix=/usr
    - --sysconfdir=/etc
    - --with-bug-report-url=https://github.com/snapcrafters/gimp/issues/
    - --enable-binreloc
    override-build: |
      export BABL_PATH="$SNAPCRAFT_STAGE/usr/lib/babl-0.1"
      export GEGL_PATH="$SNAPCRAFT_STAGE/usr/lib/gegl-0.4"
      export XDG_DATA_DIRS=$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share
      export PYTHON=/usr/bin/python2.7
      export GIO_MODULE_DIR=$SNAPCRAFT_STAGE/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/gio/modules

      export GDK_PIXBUF_MODULEDIR=$SNAPCRAFT_STAGE/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders
      $SNAPCRAFT_STAGE/usr/bin/gdk-pixbuf-query-loaders > $SNAPCRAFT_STAGE/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache

      sed -i 's|^Exec=.*|Exec=gimp %U|;s|^Icon=.*|Icon=${SNAP}/usr/share/icons/hicolor/256x256/apps/gimp.png|' \
        desktop/gimp.desktop.in.in

      if [ -x ./autogen.sh ]; then env NOCONFIGURE=1 ./autogen.sh; fi

      ./configure --prefix=/usr --sysconfdir=/etc --with-bug-report-url=https://github.com/snapcrafters/gimp/issues/ --enable-binreloc
      make -j$SNAPCRAFT_PARALLEL_BUILD_COUNT
      make DESTDIR=$SNAPCRAFT_PART_INSTALL install

      sed -i -E "s|^(.*python=).*|\1/snap/$SNAPCRAFT_PROJECT_NAME/current/usr/bin/python|" $SNAPCRAFT_PART_INSTALL/usr/lib/gimp/2.0/interpreters/pygimp.interp || true
    build-packages:
    - intltool
    - iso-codes
    - libaa1-dev
    - libart-2.0-dev
    - libbz2-dev
    - libcurl4-gnutls-dev
    - libexif-dev
    - libfftw3-dev
    - libgpm-dev
    - libice-dev
    - libjpeg8-dev
    - libsm-dev
    - libtiff5-dev
    - libxcursor-dev
    - libxmu-dev
    - libxpm-dev
    - libxt-dev
    - zlib1g-dev
    - patchutils
    - python-dev
    - xsltproc
    stage-packages:
    - libaa1
    - libart-2.0-2
    - libbz2-1.0
    - libcurl3-gnutls
    - libexif12
    - libfftw3-double3
    - libfftw3-long3
    - libfftw3-quad3
    - libfftw3-single3
    - libgpm2
    - libice6
    - libjpeg8
    - libsm6
    - libtiff5
    - libxcursor1
    - libxmu6
    - libxpm4
    - libxt6
    - python-dev
    - xdg-utils
    - zlib1g

  gimp-postbuild:
    after: [gimp]
    plugin: nil
    override-build: |
      export GDK_PIXBUF_MODULEDIR="$SNAPCRAFT_STAGE/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders"
      export XDG_DATA_DIRS="$SNAPCRAFT_STAGE/usr/share:/usr/local/share:/usr/share"

      $SNAPCRAFT_STAGE/usr/bin/gdk-pixbuf-query-loaders > $SNAPCRAFT_STAGE/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache
      $SNAPCRAFT_STAGE/usr/bin/gtk-update-icon-cache $SNAPCRAFT_STAGE/usr/share/icons/hicolor

      mkdir -p $SNAPCRAFT_PART_INSTALL/usr/share/icons/hicolor
      cp $SNAPCRAFT_STAGE/usr/share/icons/hicolor/index.theme $SNAPCRAFT_PART_INSTALL/usr/share/icons/hicolor/index.theme
